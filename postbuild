#!/bin/bash

# 1. CRITICAL FIX: Set Octave's library path
# This is necessary because the default library search path often breaks 
# when dependencies are installed via apt. This path points to where 
# Octave's core libraries reside.
export LD_LIBRARY_PATH="/usr/lib/x86_64-linux-gnu/octave/${OCTAVE_VERSION}/"

# 2. Install the necessary 'fltk' package (known to be more stable than gnuplot)
# We use 'pkg install' instead of including it in requirements to force the install
# within the correct Octave environment context.
octave --no-gui --eval 'pkg install -forge fltk;'

# 3. Explicitly set the graphics toolkit to fltk
# The 'inline' backend is what allows the image to be displayed in Jupyter.
octave --no-gui --eval 'pkg load fltk; graphics_toolkit ("fltk");'

octave --no-gui --eval 'warning ("off", "Octave:graphics_toolkit_set");'

# 4. Save the new paths and configurations.
octave --no-gui --eval 'savepath'